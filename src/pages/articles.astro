---
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroSection from '../components/HeroSection.astro';
import CTAButton from '../components/CTAButton.astro';
import { getCollection } from 'astro:content';

const allArticles = await getCollection('articles', ({ data }) => {
  return data.draft !== true;
});
const sortedArticles = allArticles.sort((a, b) =>
  new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);
---

<BaseLayout
  title="Health Articles & Resources"
  description="Evidence-based articles on natural health, nutrition, herbal medicine and naturopathic treatments by Dr. Colin MacLeod ND in Halifax, Nova Scotia."
  focusKeyword="naturopathic health articles Halifax"
>
  <HeroSection title="Articles" centered compact>
    <p>Evidence-based articles on natural health, nutrition and treatment approaches</p>
  </HeroSection>

  <section class="py-12 lg:py-20 bg-white">
    <div class="section-shell">
      <div class="max-w-3xl mx-auto reveal">
        {sortedArticles.map((article) => (
          <a
            href={`/articles/${article.slug}`}
            class="group flex items-center gap-4 py-5 border-b border-gray-100 last:border-0 -mx-4 px-4 rounded-lg hover:bg-emerald-50/50 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-inset"
          >
            <div class="flex-1 min-w-0">
              <time class="text-xs text-gray-400 block mb-1">
                {new Date(article.data.publishDate).toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric'
                })}
              </time>
              <h2 class="text-lg sm:text-xl font-serif font-semibold text-gray-900 group-hover:text-emerald-700 transition-colors leading-snug">
                {article.data.title}
              </h2>
              <p class="text-xs text-gray-400 mt-1">By {article.data.author}</p>
            </div>
            <svg class="w-5 h-5 text-gray-300 group-hover:text-emerald-600 transition-colors flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-emerald-950 py-16 lg:py-24">
    <div class="section-shell text-center">
      <h2 class="text-3xl sm:text-4xl font-serif font-bold text-white mb-6">Take Control of Your Health</h2>
      <p class="text-lg sm:text-xl text-white/90 mb-8 max-w-3xl mx-auto leading-relaxed">
        Questions about natural health approaches? Book your appointment to discuss how naturopathic medicine can support your health goals.
      </p>
      <div class="flex justify-center">
        <CTAButton source="articles-cta" />
      </div>
    </div>
  </section>
</BaseLayout>
